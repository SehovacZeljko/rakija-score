<!-- LIST VIEW -->
@if (mode() === 'list') {
  <div class="p-4">
    @if (!dataReady()) {
      <app-loading-spinner />
    }

    <!-- Page header -->
    <div class="mb-4 flex items-center justify-between">
      <h1 class="text-xl font-semibold text-text-primary">Producenti</h1>
      <button
        type="button"
        (click)="openCreate()"
        class="flex items-center gap-1.5 rounded-[10px] bg-primary px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-primary-dark active:bg-primary-dark"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2.5"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="12" y1="5" x2="12" y2="19" />
          <line x1="5" y1="12" x2="19" y2="12" />
        </svg>
        Novi producent
      </button>
    </div>

    <!-- Search -->
    <div class="relative mb-4">
      <svg
        class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <circle cx="11" cy="11" r="8" />
        <line x1="21" y1="21" x2="16.65" y2="16.65" />
      </svg>
      <input
        type="search"
        [value]="searchQuery()"
        (input)="onSearchInput($event)"
        placeholder="Pretraži producente..."
        class="w-full rounded-xl border border-border-default bg-bg-card py-2.5 pl-9 pr-4 text-sm text-text-primary placeholder:text-text-muted focus:border-border-focus focus:outline-none"
      />
    </div>

    <!-- Producer list -->
    @for (producer of filteredProducers(); track producer.producerId) {
      <button
        type="button"
        (click)="openEdit(producer)"
        class="mb-3 w-full rounded-xl bg-bg-card p-4 text-left shadow-[0_1px_4px_rgba(0,0,0,0.08)] transition-shadow hover:shadow-[0_2px_8px_rgba(0,0,0,0.12)] active:shadow-none"
      >
        <div class="flex items-start justify-between gap-2">
          <div class="min-w-0">
            <p class="truncate font-semibold text-text-primary">{{ producer.name }}</p>
            @if (producer.contactPerson) {
              <p class="mt-0.5 truncate text-sm text-text-secondary">{{ producer.contactPerson }}</p>
            }
            @if (producer.region || producer.country) {
              <p class="mt-1 text-xs text-text-muted">
                {{ producer.region }}{{ producer.region && producer.country ? ', ' : '' }}{{ producer.country }}
              </p>
            }
          </div>
          <!-- Edit chevron -->
          <svg
            class="mt-0.5 shrink-0 text-text-muted"
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polyline points="9 18 15 12 9 6" />
          </svg>
        </div>
      </button>
    } @empty {
      <div class="rounded-xl bg-bg-card p-6 text-center shadow-[0_1px_4px_rgba(0,0,0,0.08)]">
        @if (searchQuery()) {
          <p class="text-sm text-text-secondary">Nema rezultata za "{{ searchQuery() }}".</p>
        } @else {
          <p class="text-sm text-text-secondary">Nema producenata. Dodajte prvog producenta.</p>
        }
      </div>
    }
  </div>
}

<!-- CREATE / EDIT FORM -->
@if (mode() === 'create' || mode() === 'edit') {
  <div class="p-4">
    <!-- Form header -->
    <div class="mb-4 flex items-center gap-3">
      <button
        type="button"
        (click)="cancel()"
        class="flex h-9 w-9 items-center justify-center rounded-lg text-text-secondary transition-colors hover:bg-bg-surface"
        aria-label="Nazad"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <polyline points="15 18 9 12 15 6" />
        </svg>
      </button>
      <h1 class="text-xl font-semibold text-text-primary">
        {{ mode() === 'create' ? 'Novi producent' : 'Uredi producenta' }}
      </h1>
    </div>

    <!-- Form card -->
    <div [formGroup]="form" class="rounded-xl bg-bg-card p-4 shadow-[0_1px_4px_rgba(0,0,0,0.08)]">
      <!-- Name -->
      <div class="mb-4">
        <label class="mb-1.5 block text-sm font-medium text-text-secondary">
          Naziv <span class="text-status-error">*</span>
        </label>
        <input
          type="text"
          formControlName="name"
          placeholder="Naziv producenta"
          class="w-full rounded-lg border border-border-default bg-bg-surface px-3 py-2.5 text-sm text-text-primary placeholder:text-text-muted focus:border-border-focus focus:outline-none"
          [class.border-status-error]="form.controls.name.invalid && form.controls.name.touched"
        />
      </div>

      <!-- Contact person -->
      <div class="mb-4">
        <label class="mb-1.5 block text-sm font-medium text-text-secondary">Kontakt osoba</label>
        <input
          type="text"
          formControlName="contactPerson"
          placeholder="Ime i prezime"
          class="w-full rounded-lg border border-border-default bg-bg-surface px-3 py-2.5 text-sm text-text-primary placeholder:text-text-muted focus:border-border-focus focus:outline-none"
        />
      </div>

      <!-- Email + Phone row -->
      <div class="mb-4 flex gap-3">
        <div class="flex-1">
          <label class="mb-1.5 block text-sm font-medium text-text-secondary">Email</label>
          <input
            type="email"
            formControlName="email"
            placeholder="email@primjer.com"
            class="w-full rounded-lg border border-border-default bg-bg-surface px-3 py-2.5 text-sm text-text-primary placeholder:text-text-muted focus:border-border-focus focus:outline-none"
          />
        </div>
        <div class="w-36">
          <label class="mb-1.5 block text-sm font-medium text-text-secondary">Telefon</label>
          <input
            type="tel"
            formControlName="phone"
            placeholder="+387..."
            class="w-full rounded-lg border border-border-default bg-bg-surface px-3 py-2.5 text-sm text-text-primary placeholder:text-text-muted focus:border-border-focus focus:outline-none"
          />
        </div>
      </div>

      <!-- Address -->
      <div class="mb-4">
        <label class="mb-1.5 block text-sm font-medium text-text-secondary">Adresa</label>
        <input
          type="text"
          formControlName="address"
          placeholder="Ulica i broj"
          class="w-full rounded-lg border border-border-default bg-bg-surface px-3 py-2.5 text-sm text-text-primary placeholder:text-text-muted focus:border-border-focus focus:outline-none"
        />
      </div>

      <!-- Region + Country row -->
      <div class="flex gap-3">
        <div class="flex-1">
          <label class="mb-1.5 block text-sm font-medium text-text-secondary">Region</label>
          <input
            type="text"
            formControlName="region"
            placeholder="npr. Hercegovina"
            class="w-full rounded-lg border border-border-default bg-bg-surface px-3 py-2.5 text-sm text-text-primary placeholder:text-text-muted focus:border-border-focus focus:outline-none"
          />
        </div>
        <div class="flex-1">
          <label class="mb-1.5 block text-sm font-medium text-text-secondary">Zemlja</label>
          <input
            type="text"
            formControlName="country"
            placeholder="npr. Bosna i Hercegovina"
            class="w-full rounded-lg border border-border-default bg-bg-surface px-3 py-2.5 text-sm text-text-primary placeholder:text-text-muted focus:border-border-focus focus:outline-none"
          />
        </div>
      </div>
    </div>

    <!-- Action buttons -->
    <div class="mt-4 flex gap-3">
      <button
        type="button"
        (click)="save()"
        [disabled]="form.invalid || isSaving()"
        class="flex-1 rounded-[10px] bg-primary py-3 text-sm font-semibold text-white transition-colors hover:bg-primary-dark disabled:cursor-not-allowed disabled:opacity-50"
      >
        {{ isSaving() ? 'Čuvanje...' : 'Sačuvaj' }}
      </button>
      <button
        type="button"
        (click)="cancel()"
        class="rounded-[10px] bg-bg-surface px-6 py-3 text-sm font-semibold text-text-secondary transition-colors hover:bg-border-default"
      >
        Otkaži
      </button>
    </div>
  </div>
}
