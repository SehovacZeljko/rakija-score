<app-header title="Sudija" />

<main class="min-h-screen bg-bg-app pb-[60px] pt-14">
  <div class="p-4">

    <!-- Judge greeting -->
    <div class="mb-4">
      <p class="text-sm text-text-secondary">Dobrodošli,</p>
      <p class="text-lg font-semibold text-text-primary">{{ currentUser()?.username }}</p>
    </div>

    @if (!dataReady()) {
      <app-loading-spinner />
    } @else if (!activeFestival()) {
      <div class="rounded-xl bg-bg-card p-6 text-center shadow-[0_1px_4px_rgba(0,0,0,0.08)]">
        <p class="text-sm text-text-secondary">Nema aktivnog festivala.</p>
      </div>
    } @else {
      <app-active-festival-banner />

      @if (!activeEvent()) {
        <div class="rounded-xl bg-bg-card p-6 text-center shadow-[0_1px_4px_rgba(0,0,0,0.08)]">
          <p class="text-sm text-text-secondary">Nema aktivnog dogadjaja.</p>
          <p class="mt-1 text-xs text-text-muted">Administrator će aktivirati dogadjaj.</p>
        </div>
      } @else if (categoryCards().length === 0) {
        <div class="rounded-xl bg-bg-card p-6 text-center shadow-[0_1px_4px_rgba(0,0,0,0.08)]">
          <p class="text-sm text-text-secondary">Nemate dodijeljenih kategorija.</p>
          <p class="mt-1 text-xs text-text-muted">Administrator će vam dodijeliti kategorije.</p>
        </div>
      } @else {
        <p class="mb-3 text-xs font-medium uppercase tracking-[0.05em] text-text-muted">
          Kategorije
        </p>

        @for (card of categoryCards(); track card.categoryId) {
          <button
            type="button"
            (click)="navigateToCategory(card.categoryId)"
            class="mb-3 w-full rounded-xl bg-bg-card p-4 text-left shadow-[0_1px_4px_rgba(0,0,0,0.08)] transition-colors active:bg-bg-surface"
          >
            <!-- Header row -->
            <div class="flex items-start justify-between gap-3">
              <p class="font-semibold text-text-primary">{{ card.name }}</p>
              @if (card.isLocked) {
                <svg
                  class="mt-0.5 shrink-0 text-status-locked"
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                  <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                </svg>
              }
            </div>

            <!-- Score badge -->
            <div class="mt-2">
              <span
                class="rounded-full px-2.5 py-0.5 text-xs font-medium"
                [class.bg-status-success]="card.scoredCount === card.sampleCount && card.sampleCount > 0"
                [class.text-white]="card.scoredCount === card.sampleCount && card.sampleCount > 0"
                [class.bg-bg-surface]="card.scoredCount < card.sampleCount || card.sampleCount === 0"
                [class.text-text-secondary]="card.scoredCount < card.sampleCount || card.sampleCount === 0"
              >
                {{ card.scoredCount }} / {{ card.sampleCount }} ocijenjeno
              </span>
            </div>

            <!-- Progress bar -->
            @if (card.sampleCount > 0) {
              <div class="mt-3 h-1.5 w-full overflow-hidden rounded-full bg-bg-surface">
                <div
                  class="h-full rounded-full bg-accent transition-all"
                  [style.width.%]="(card.scoredCount / card.sampleCount) * 100"
                ></div>
              </div>
            }
          </button>
        }
      }
    }

  </div>
</main>

<app-bottom-nav [items]="navItems" />
